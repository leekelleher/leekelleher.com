@{
	var dateFormat = Model.String("ArchiveDateFormat");
	var archiveDate = Model.String("ArchiveDate");
	
	var posts = Documents
		.ContainsKey("date");
	
	var archivePosts = posts
		.Where(x => x.Get<DateTime>("date").ToString(dateFormat) == archiveDate)
		.OrderBy(x => x.Get<DateTime>("date"));
	
	var years = posts
		.Select(x => x.Get<DateTime>("date").Year)
		.Distinct()
		.OrderByDescending(x => x);
}

<section>
	<header>
		<h1>@Model.String("title")</h1>
	</header>
	<ul>
	@foreach (var year in archivePosts.GroupBy(x => x.Get<DateTime>("date").Year))
	{
		foreach (var month in year.GroupBy(x => x.Get<DateTime>("date").ToString("MMMM")))
		{
			ViewData["PostListDocuments"] = month;
			<li>
				<h2>@month.Key @year.Key</h2>
				@Html.Partial("_layouts/postListing")
			</li>
		}
	}
	</ul>
</section>

<section>
	<header>
		<h2>Year archive</h2>
	</header>
	<ul>
		@foreach (var year in years)
		{
			<li>
				<a href="/@year/">@year</a>
			</li>
		}
	</ul>
</section>

<section>
	<header>
		<h2>Tag archive</h2>
	</header>
	<p><a href="/tag/">View all tags</a>.</p>
</section>
